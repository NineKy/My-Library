# ORA-00060: deadlock detected while waiting for resource 

<br><br>
교착 상태란? <br>
나무위키에서 알려주길, "두 개 이상의 작업이 서로 상대방의 작업이 끝나기 만을 기다리고 있기 때문에 어떻게든 결론이 나지 않는 상태"를 의미한다 <br>
해당 상황이 발생할 수 있는 상황은 아래와 같다 <br>
- 비선점 > 지원을 선점하지 않음
- 환형대기 > 원형으로 자원을 대기 중
- 상호배제 > 자원은 하나의 프로세스만 점유 가능
- 점유대기 > 자원에 고유번호 할당 후 순서대로 자원 

<br>
이렇게 디비에서 트랜잭션(작업 단위)가 교착상태로 되어있는 상황에서 오라클은 교착상태인 상황을 확인하고, 오라클이 위의 ORA-00060 을 뱉으면서 교착상태를 풀어주게 된다 <br> 
백엔드 서버에서 발생하는 교착상태면 역시 디비에 걸려있는 락과 관련있을 것이라고 예상을 했고 <br>
디비에서 락은 거는 케이스는 크게 2가지가 있는 것으로 알고 있다 <br>
@Lock 을 통해서 조회 시, for update 문을 날리는 케이스 / 특정 로우에 대한 update 문이 날라가는 케이스 <br>
<br>

우선 이번에 해당 이슈가 발생한 프로젝트에서는 @Lock 을 통해서 락을 걸고 처리하는 방식은 별로 많지 않았기에 그렇게 엄청 의심가는게 있지는 않았다 <br>
그렇게 확인해보니 @Lock 을 통해서 나가는 사항 자체는 따로 없었다 <br>
다음으로는 그럼 해당 에러가 발생한 시점에 돌아가고 있는 트랜잭션들을 쭉 확인했다 <br>
정확하게는 에러가 발생한 로직에서 디비에 insert/update 치는 것들이 있는지 확인, 트랜잭션 안에서 언제 해당 쿼리가 디비에 날아가는지 확인했다 <br>
그리고 디비에 update, insert 문이 날아가는 케이스에서 어떻게 교착상태가 생성되었는지 고민해봤다 <br
<br><br>


 

<br><br><br><br><br><br><br><br><br><br>