# 연관관계 매핑 기초

엔티티들은 다른 엔티티와 연관관계가 많이 이루어진다. 객체 같은 경우에는 참조라는 주소를 이용해서 다른 객체와 관계를 맺지만 테이블 같은 경우에는 외래 키를 사용해서 다른 테이블과 관계를 맺는다. 이처럼 객체와 테이블은 다르게 참조하고 있는데, 이렇게 객체의 연관관계랑 테이블의 연관관계를 연결? 동기화? 시키는 것이 매핑이라고 볼 수 있고 이것이 목표이다.

### 연관관계 매핑에서 중요한 키워드

* 방향
  * 단방향, 양방향이 있다. 단방향은 한쪽만 참조하고 있는 경우를 의미하고 양방향은 양쪽 모두가 서로를 참조하는 관계이다.
  * 말 그대로의 관계들이고, 방향이라는 키워드는 사실 객체관계에만 존재하고 있으며, 테이블의 관계는 항상 양방향 관계로 이루어져 있다.
* 다중성
  * 연관관계를 맺을 때, 사용 횟수?라고 하긴 좀 애매하지만 각 연관관계에서 한 번만 참조하느냐 여러번 참조하느냐를 보여준다.
  * 일대일, 다대일, 일대다, 다대다 이렇게 종류가 있다.
* 연관관계의 주인
  * 양방향 관계 상황에서 연관관계의 주가 되는 엔티티를 연관관계의 주인이라고 부른다.

### 단방향 연관관계

일단은 다대일에 대해서 알아봐야한다.

진행을 위한 예시

* 회원과 팀이 있다.
* 회원은 하나의 팀에만 소속될 수 있다.
* 회원과 팀은 다대일 관계이다.

구조는 이렇다.

```java
Member
- id, username, Team

Team
- id, name
```

```java
Member
- MEMEBER_ID, TEAM_ID, USERNAME

Team
- TEAM_ID, NAME
```

이 예시를 객체 연관관계와 테이블 연관관계부터 시작

* 객체 연관관계
  * Member 객체는 member의 team 필드로 Team객체와 연관관계를 맺는다.
  * Member 객체와 Team 객체는 단방향 관계인데, Member 객체의 필드 Team을 통해서 Member에서는 Team에 대한 정보를 가지고 있어야 하지만, Team객체는 어떠한 Member를 가지고 있는지 저장하는 필드가 없기 때문에 단방향 관계라고 볼 수 있다.
*   테이블 연관관계

    * TEAM\_ID를 통해서 Member 객체와 Team 객체가 연결이 된다.
    * 위에서 말했듯이, 테이블 간의 방향은 양방향 관계이다.
    * 이렇게 서로 조인을 해줘야 한다

    ```java
    SELECT * FROM MEMBER M
    JOIN TEAM T ON M.TEAM_ID = T.TEAM_ID

    SELECT * FROM TEAM T
    JOIN MEMBER M ON T.TEAM_ID = M.TEAM_ID
    ```

    * 그리고 조금 더 정확하게 보면 이건 양방향이라고 보기보다는 서로 다른 단방향이 이어져 있다고 볼 수 있다.

그러면 객체 연관관계와 테이블 연관관계를 정리해보자

객체는 참조를 통해서 연관관계를 이루고, 테이블은 외래 키를 통해서 연관관계를 이룬다

예를 들면 참조를 사용하는 객체는 get을 사용해서 값을 가져오지만 테이블은 조인을 사용해서 가져온다

객체의 참조는 단방향으로 볼 수 있지만 외래키를 사용하는 테이블의 연관관계를 양방향이라서 A JOIN B가 가능하면 B JOIN A 이렇게 사용할 수 있다.
