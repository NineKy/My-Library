# 생성자나 열거 타입으로 싱글톤임을 보증하라

<br><br>

무조건적으로 싱글턴으로 만들어서 사용하라는 의미는 아니고, 꼭 하나만 존재해야하는 것이나 하나의 인스턴스만 가지고 시스템이 돌아가는 그러한 케이스들이 존재한다 <br>
예시로 보면 게임의 설정을 진행하는데 있어서 한국어로 진행할 것인지, 영어로 진행할 것인지 정할때 정하고나서 설정된 언어가 바뀌면 게임할 때 영어와 한국어가 뒤죽박죽일 것이다 <br>
이런 케이스에 사용하면 된다고 보면 된다 <br>
그렇기 때문에 무조건적으로 이렇게 하는게 좋다! 가 아니라 필요할 때 사용하면 된다
<br>

## 생성자를 사용하는 방법 - private 생성자 + public static final 필드 <br>
장점으로는 알아보기 쉬우며 간결하다. 그리고, 싱글톤의 장점을 활용해서 사용하는 것이 가능하다고 한다 <br>
하지만 실제로 그렇게 쓰는건 본인 기준으로는 보기 쉽지는 않았다.. 그 이유는 역시 그럼 단점이 많은 것이겠지? <br>

단점으로는 **클라이언트의 클래스를 테스트하기 어려워진다** 라고 되어있는데, <br>
우선 클라이언트 코드란, 싱글톤으로 생성한 클래스와 해당 인스턴스를 사용하는 코드라고 볼 수 있다 <br>
클라이언트에서 테스트를 진행하는데 있어서, 클라이언트를 테스트 진행할 때 싱글톤으로 생성한 놈을 부르는 순간, <br>
단 하나의 인스턴스로 구성되어있기 때문에 그 인스턴스를 가져와서 테스트를 진행하게 된다 <br>
<br>

강의에서 말씀하신 콘서트장에서 콘서트 준비를 하면서 항상 엘비스를 불러다가 여러가지 조명이나 장막 등등을 테스트할 수는 없는 것이랑 같다 <br>
<br>

우선적으로 이러한 문제를 해결하는 방법으로는 **해당 클래스의 인터페이스를 구현** 이 방법이다 <br>
해당 클래스로부터 인터페이스를 만들고, 싱글톤 클래스를 해당 인터페이스를 implement하게 만들어두고, 또 새로운 테스트용 클래스를 생성하는 것이 방법이다 <br>
예시로 보면 엘비스를 포함하는 I엘비스라는 인터페이스를 생성하고, Mock엘비스라고 만들어둔 다음, Mock엘비스를 가지고 테스트를 진행할 수 있는 것이다 <br>
<br><br>

또 다른 단점으로는 **리플렉션으로 private 생성자를 호출할 수 있다**는 것이다 <br>
그리고 위의 의미는 결국 싱글톤이 깨진다는 의미를 가지고 있는 것이다 -> 그럼 결국 싱글톤의 의미가 사라지는 그러한 모순이 생기는 것이다 <br>
<br>

하는 방법으로는 <br>
class.getDeclaredConstructor()를 통해서 생성자를 들고오고, setAccessable을 통해서 자바코드에서 접근 가능하도록 설정 후, 생성하면 생성할 수 있다 <br>
이러한 버그?성을 막기 위해서는 원본클래스에서 생성자가 한 번 이상 불리는 것을 막아주는 방어코드를 집어넣어주라고 하고 있다 <br>
<br>

이 외에도 문제가 있는게, 직렬화 <> 역직렬화 하는 과정에서 기존 객체가 나오는 것이 아닌 새로운 객체가 계속해서 생성된다는 문제가 존재한다 <br>
위 문제는 또 readResolve이라는 함수를 통해서 역직렬화를 통해서 보장해주는 것이 가능하다고 한다 <br>
<br>

이렇게 계속해서 단점이 쌓여가는 상황이다 <br>

## 생성자를 사용하는 방법 - private 생성자 + 정적 팩토리 메소드
첫 번째의 경우와는 다르게, 직접 public한 인스턴스를 가져와서 사용하는 것이 아닌, private 한 인스턴스를 생성해두고, getInstance와 같이 인스턴스를 꺼내주는 함수를 public으로 만들어서 사용하도록 하는 방법이다 <br>
일단 이 방법에 대해서는 어떻게 보면 그냥 눈가리고 아웅 하는 느낌이다 그래서 단점도 첫 번째와 같이 가지고 있는 상황이다 <br>
하지만 그래도 장점이 더 있다고하니 봐보자 <br>

첫 번째 장점으로는 클라이언트가 더욱 간결해진다는 점이다 그 의미는 어떠한 로직이 추가될지 모르는 등 다양한 경우에 만약 실제 그냥 인스턴스를 가져왔다면 <br>
코드가 더 길어지면서 알아보기 힘들게 된다는 점이다 하지만 인스턴스를 꺼내주는 함수를 사용함으로써 **클라이언트의 코드는 그대로 두되, 인스턴스에 대한 조작이 가능**하다 <br>
<br>

두 번쨰 장점으로는 제네릭 싱글톤 팩토리를 사용할 수 있다 인데, <br>
우선 이것은 제네릭 타입을 통해서 인스턴스를 내뱉고 싶을 때, 원하는 타입을 통해서 인스턴스를 생성하는 것이 가능하다는 것이다 <br>
그 의미는, **같은 인스턴스를 원하는 타입으로 형변환을 해서 사용할 수 있다는** 장점을 가진다는 의미이다 <br>
제네릭 싱글톤 팩토리에 엄청난 것이 들어가는 것도 아니고 단지 형변환만 해주는 코드만 들어가는 상황이다 <br>
<br>

마지막 장점은 정적 팩토리의 메소드 참조를 supplier로 사용할 수 있다는 것인데 <br>
supplier...